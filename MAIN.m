clc
clear

lb = [...
    0.01 0.30 6.85 0.39 0.10 -3 ...
      0.30 6.85 0.45 0.04 -5 ...
      0.30 6.85 0.39 0.10 -3 ...
      0.30 6.85 0.39 0.04 -5 ...
    ];

ub = [ ...
    0.6 0.60 7.49 0.8 0.25 5 ...
      0.60 7.50 0.8 0.15 5 ...
      0.60 7.49 0.8 0.25 5 ...
      0.60 7.50 0.8 0.15 5 ...
    ];


% Winglet start location (distance in from wingtip along LE)
% Front (upper) transition panel 
% Front (upper) outter panel
% Rear (lower) transition panel
% Rear (lower) outter panel

A = [...
    % staggering x-location of transition panels
    0 1 0 0 1 0 ...
      0 0 0 0 0 ...
     -1 0 0 0 0 ...
      0 0 0 0 0; ...

    % staggering x-location of outter panels
    0 0 0 0 0 0 ...
      1 0 0 1 0 ...
      0 0 0 0 0 ...
     -1 0 0 0 0; ...
    
    % going outward on front tip
    0 0 1 0 0 0 ...
      0 -1 0 0 0 ...
      0 0 0 0 0 ...
      0 0 0 0 0; ...
    
    % going outward on rear tip
    0 0 0 0 0 0 ...
      0 0 0 0 0 ...
      0 1 0 0 0 ...
      0 -1 0 0 0; ...
    
    % seperating the transition panels enough
    0.5 0 0 -1 0 0 ...
      0 0 0 0 0 ...
      0 0 0 0 0 ...
      0 0 0 0 0; ...    
        
    % tapering on the front tip
    0 0 0 0 -1 0 ...
      0 0 0 1 0 ...
      0 0 0 0 0 ...
      0 0 0 0 0; ... 
    
    % tapering on the rear tip
    0 0 0 0 0 0 ...
      0 0 0 0 0 ...
      0 0 0 -1 0 ...
      0 0 0 1 0; ...

    % staggering x-location of front outter panel and rear inner panel
    0 0 0 0 0 0 ...
      1 0 0 1 0 ...
     -1 0 0 0 0 ...
      0 0 0 0 0; ...    
     
      % Need to be: 7.5 - z(1) < z(3) - 0.1
    % going outward on front tip
    -1 0 -1 0 0 0 ...
      0 0 0 0 0 ...
      0 0 0 0 0 ...
      0 0 0 0 0; ...
    
    % going outward on rear tip
    -1 0 0 0 0 0 ...
      0 0 0 0 0 ...
      0 -1 0 0 0 ...
      0 0 0 0 0; ...
      
      ];

b = [...
    -0.05 ... % staggering x-location of transition panels
    -0.05 ... % staggering x-location of outter panels
    -0.1 ... % going outward on front tip
    -0.1 ... % going outward on rear tip   
    -0.15 ... % seperating the transition panels enough
    -0.005 ... % tapering on the front tip
    -0.005 ... % tapering on the rear tip
    -0.05 ... % staggering x-location of front outter panel and rear inner panel
    -7.75 ... % going outward on front tip
    -7.75 ... % going outward on rear tip 
    ];

Aeq = [];
beq = [];

nvars = 21;
TolCon_Data = 1e-6; 
TolFun_Data = 1e-08;

options = gaoptimset;
options = gaoptimset(options,'TolFun', TolFun_Data);
% options = gaoptimset(options,'CrossoverFraction', 0.5);
options = gaoptimset(options,'Display', 'iter');
% options = gaoptimset(options,'InitialPopulation', Seed);
options = gaoptimset(options,'PlotFcns', {  @gaplotbestf @gaplotbestindiv @gaplotexpectation @gaplotscorediversity @gaplotstopping });
options = gaoptimset(options,'Vectorized', 'off');
options = gaoptimset(options,'UseParallel', 1 );
options = gaoptimset(options,'Generations',1000,'StallGenLimit', 50);
[x,fval,exitflag,output,population,score] = gamultiobj(@fcnOBJFUNC,nvars,A,b,Aeq,beq,lb,ub,[],options);